{% extends 'bookshelf/base.html' %}

{% block title %}{{ book.title }} - {{ block.super }}{% endblock %}

{% block content %}
<div class="row">
    <div class="col-md-8">
        <!-- Book Details Card -->
        <div class="card">
            <div class="card-header">
                <h4 class="mb-0">üìñ {{ book.title|escape }}</h4>
                <small class="text-muted">Book Details</small>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-8">
                        <dl class="row">
                            <dt class="col-sm-4">Title:</dt>
                            <dd class="col-sm-8">{{ book.title|escape }}</dd>
                            
                            <dt class="col-sm-4">Author:</dt>
                            <dd class="col-sm-8">{{ book.author|escape }}</dd>
                            
                            <dt class="col-sm-4">Publication Year:</dt>
                            <dd class="col-sm-8">{{ book.publication_year }}</dd>
                            
                            {% if book.isbn %}
                                <dt class="col-sm-4">ISBN:</dt>
                                <dd class="col-sm-8">{{ book.isbn|escape }}</dd>
                            {% endif %}
                            
                            {% if book.description %}
                                <dt class="col-sm-4">Description:</dt>
                                <dd class="col-sm-8">{{ book.description|escape|linebreaks }}</dd>
                            {% endif %}
                        </dl>
                    </div>
                    
                    <div class="col-md-4">
                        <!-- Book Actions -->
                        <div class="d-grid gap-2">
                            {% if user.has_perm:'bookshelf.can_edit' %}
                                <a href="{% url 'book-edit' book.pk %}" class="btn btn-warning">
                                    ‚úèÔ∏è Edit Book
                                </a>
                            {% endif %}
                            
                            {% if user.has_perm:'bookshelf.can_delete' %}
                                <form method="POST" action="{% url 'book-delete' book.pk %}" 
                                      onsubmit="return confirm('Are you sure you want to delete this book? This action cannot be undone.');">
                                    {% csrf_token %}
                                    <button type="submit" class="btn btn-danger w-100">
                                        üóëÔ∏è Delete Book
                                    </button>
                                </form>
                            {% endif %}
                            
                            <a href="{% url 'book-list' %}" class="btn btn-outline-secondary">
                                ‚¨ÖÔ∏è Back to List
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <div class="col-md-4">
        <!-- Metadata Card -->
        <div class="card">
            <div class="card-header">
                <h6 class="mb-0">üìä Metadata</h6>
            </div>
            <div class="card-body">
                <ul class="list-unstyled">
                    <li><strong>Created:</strong><br>{{ book.created_at|date:"M d, Y H:i" }}</li>
                    <li><strong>Last Updated:</strong><br>{{ book.updated_at|date:"M d, Y H:i" }}</li>
                    {% if book.added_by %}
                        <li><strong>Added By:</strong><br>{{ book.added_by.username|escape }}</li>
                    {% endif %}
                </ul>
            </div>
        </div>
        
        <!-- User Permissions Card -->
        <div class="card mt-3">
            <div class="card-header">
                <h6 class="mb-0">üîê Your Permissions</h6>
            </div>
            <div class="card-body">
                <ul class="list-unstyled mb-0">
                    <li>
                        {% if user.has_perm:'bookshelf.can_view' %}
                            ‚úÖ View Books
                        {% else %}
                            ‚ùå View Books
                        {% endif %}
                    </li>
                    <li>
                        {% if user.has_perm:'bookshelf.can_edit' %}
                            ‚úÖ Edit Books
                        {% else %}
                            ‚ùå Edit Books
                        {% endif %}
                    </li>
                    <li>
                        {% if user.has_perm:'bookshelf.can_delete' %}
                            ‚úÖ Delete Books
                        {% else %}
                            ‚ùå Delete Books
                        {% endif %}
                    </li>
                </ul>
            </div>
        </div>
        
        <!-- Security Information -->
        <div class="card mt-3">
            <div class="card-header">
                <h6 class="mb-0">üîí Security Status</h6>
            </div>
            <div class="card-body">
                <ul class="list-unstyled mb-0">
                    <li>‚úÖ Permission-based access</li>
                    <li>‚úÖ XSS protection active</li>
                    <li>‚úÖ CSRF protection on forms</li>
                    <li>‚úÖ Input sanitization</li>
                    <li>‚úÖ Audit trail enabled</li>
                </ul>
            </div>
        </div>
    </div>
</div>
{% endblock %}
